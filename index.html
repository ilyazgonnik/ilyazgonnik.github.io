<!DOCTYPE html>
<html>
<head>
  <title>AI Fetish Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-md mx-auto mt-10 p-4 bg-white rounded-lg shadow">
    <h1 class="text-2xl font-bold mb-4">Chat with Venice AIIIIII</h1>
    <div id="chatbox" class="mb-4 h-64 overflow-y-auto border p-2 rounded"></div>
    <input 
      id="userInput" 
      type="text" 
      placeholder="Ask me anything..." 
      class="w-full p-2 border rounded"
      onkeypress="if(event.key === 'Enter') sendMessage()"
    >
    <button onclick="sendMessage()" class="mt-2 bg-purple-600 text-white p-2 rounded w-full">
      Send
    </button>
  </div>

  <script>
    const part1 = "sk-or-v1-9bf669a56ac1f5c2d3148908d"
    const part2 = "d6a36ff5beef3edf6d86bbf0111c6554ff41441"
    const OPENROUTER_API_KEY = part1 + part2; // Get from https://openrouter.ai/keys
    let conversationHistory = [];

    async function sendMessage() {
      const userInput = document.getElementById('userInput').value;
      const chatbox = document.getElementById('chatbox');
      
      if (!userInput.trim()) return;

      // Add user message to UI and history
      chatbox.innerHTML += `<p class="text-right mb-2"><span class="bg-purple-100 px-3 py-1 rounded-lg">You: ${userInput}</span></p>`;
      conversationHistory.push({ role: "user", content: userInput });
      document.getElementById('userInput').value = '';

      // Typing indicator
      const typingIndicator = document.createElement('p');
      typingIndicator.className = 'text-left mb-2 text-gray-500';
      typingIndicator.innerHTML = '<i>AI is typing...</i>';
      chatbox.appendChild(typingIndicator);
      chatbox.scrollTop = chatbox.scrollHeight;

      try {
        const response = await fetch('http://localhost:8000/api/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    messages: conversationHistory  // Отправляем только историю сообщений
  })
});

        if (!response.ok) throw new Error(`API error: ${response.status}`);
        const data = await response.json();
        const aiReply = data.choices[0].message.content;

        // Add AI response to history and UI
        conversationHistory.push({ role: "assistant", content: aiReply });
        chatbox.removeChild(typingIndicator);
        chatbox.innerHTML += `<p class="text-left mb-2"><span class="bg-gray-100 px-3 py-1 rounded-lg">AI: ${aiReply}</span></p>`;
      } catch (error) {
        chatbox.removeChild(typingIndicator);
        chatbox.innerHTML += `<p class="text-left text-red-500"><span class="bg-red-100 px-3 py-1 rounded-lg">Error: ${error.message}</span></p>`;
      }
      chatbox.scrollTop = chatbox.scrollHeight;
    }
  </script>
</body>
</html>